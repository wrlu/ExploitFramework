package com.wrlus.expfwk.cmd.info;

import com.wrlus.expfwk.env.Env;
import android.content.Context;
import android.content.pm.PackageManager;
import android.content.pm.PermissionGroupInfo;
import android.content.pm.PermissionInfo;
import android.os.IBinder;

import android.os.RemoteException;
import android.permission.IPermissionManager;
import com.wrlus.expfwk.utils.LogUtil;
import com.wrlus.expfwk.cmd.Task;
import android.os.ServiceManager;

import java.util.List;

public class PermissionTask extends Task {
    private static final String TAG = "PermissionTask";

    @Override
    public void doTask() {
        IBinder permissionMgrHandle = ServiceManager.getService("permissionmgr");
        IPermissionManager iPermissionManager = IPermissionManager.Stub.asInterface(permissionMgrHandle);
        Context context = Env.getSystemContext();
        try {
            List<PermissionGroupInfo> groupInfos = iPermissionManager.getAllPermissionGroups(3).getList();
            for (PermissionGroupInfo groupInfo : groupInfos) {
                List<PermissionInfo> permissionInfos =
                        iPermissionManager.queryPermissionsByGroup(groupInfo.name, 3).getList();
                for (PermissionInfo permissionInfo : permissionInfos) {
                    if (context.checkSelfPermission(permissionInfo.name)
                            == PackageManager.PERMISSION_GRANTED) {
                        LogUtil.i(TAG, permissionInfo.name);
                    }
                }
            }
        } catch (RemoteException e) {
            LogUtil.e(TAG, e);
        }
    }
}