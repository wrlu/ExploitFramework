import android.os.Looper;

import com.wrlus.expfwk.cmd.Task;
import com.wrlus.expfwk.cmd.ExitTask;
import com.wrlus.expfwk.cmd.HelpTask;
import com.wrlus.expfwk.cmd.component.ContentTask;
import com.wrlus.expfwk.cmd.info.PackageTask;
import com.wrlus.expfwk.cmd.info.InfoTask;
import com.wrlus.expfwk.cmd.info.PermissionTask;
import com.wrlus.expfwk.cmd.control.ApkTask;
import com.wrlus.expfwk.cmd.privacy.SmsTask;
import com.wrlus.expfwk.cmd.privacy.CallLogTask;

import com.wrlus.expfwk.utils.LogUtil;
import org.json.JSONObject;

import java.util.Scanner;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class Main {
    private static final String TAG = "Main";

    private static void showWelcome() {
        LogUtil.i(TAG, "============================================================");
        LogUtil.i(TAG, "");
        LogUtil.i(TAG, "Android Exploit Framework");
        LogUtil.i(TAG, "By wrlu (@xiaolulwr) of Singular Security Lab (@singularseclab)");
        LogUtil.i(TAG, "");
        LogUtil.i(TAG, "============================================================");
        LogUtil.i(TAG, "");
    }

    public static void main(String[] args)  {
        showWelcome();
        Looper.prepare();
        Scanner scanner = new Scanner(System.in);
        while (!Thread.currentThread().isInterrupted()) {
            System.out.print('>');
            String input = scanner.nextLine().trim().toLowerCase();
            if (input.equals("")) {
                continue;
            }
            String[] cmdAndParams = Task.resolveCmdAndParams(input);
            if (cmdAndParams == null) {
                LogUtil.e(TAG, "Invalid input");
                continue;
            }
            String cmd = cmdAndParams[0];
            String params = cmdAndParams[1];
            LogUtil.d(TAG, "input="+input+", cmd="+cmd+", params="+params);
            Task task;
            switch (cmd) {
                case Task.HELP_TASK:
                    task = new HelpTask();
                    break;
                case Task.EXIT_TASK:
                case Task.QUIT_TASK:
                    task = new ExitTask();
                    break;
                case Task.INFO_TASK:
                    task = new InfoTask();
                    break;
                case Task.PERMISSION_TASK:
                    task = new PermissionTask();
                    break;
                case Task.INSTALL_APK_TASK:
                case Task.INSTALL_PACKAGE_TASK:
                    task = new ApkTask(Task.parseParams(params));
                    break;
                case Task.READ_SMS:
                    task = new SmsTask();
                    break;
                case Task.READ_CALL_LOG:
                    task = new CallLogTask();
                    break;
                case Task.CONTENT:
                    task = new ContentTask(Task.parseParams(params));
                    break;
                case Task.READ_APP_LIST:
                    task = new PackageTask();
                    break;
                default:
                    LogUtil.e(TAG, "Unknown command: "+cmd);
                    continue;
            }
            task.doTask();
        }
    }
}
